우리는 특정 보험 상품에 대한 2016년 총 보험가치를 계산하고 싶습니다.
먼저 "보험" 표부터 살펴보겠습니다.
먼저, 2015년 보험가치가 두 번 이상 나타나는 모든 정책을 찾습니다. 이를 통해 갱신되거나 업데이트된 정책을 식별하는 데 도움이 됩니다.
다음으로, 우리는 단 하나의 정책만 존재하는 모든 고유한 위도와 경도 조합을 찾습니다. 이는 고유한 위치를 가진 정책을 식별하는 데 도움이 됩니다.
그런 다음 AND 연산자를 사용하여 두 조건을 함께 적용하여 두 기준을 모두 충족하는 정책을 필터링합니다.
마지막으로 필터링된 정책에 대한 2016년 보험가치의 합계를 계산하고 결과를 소수점 둘째 자리까지 반올림합니다.

------------------------------------------------

SELECT
    ROUND(SUM(tiv_2016), 2) AS tiv_2016
FROM
    Insurance
WHERE
    tiv_2015 IN (SELECT tiv_2015
                FROM Insurance
                GROUP BY tiv_2015
                HAVING COUNT(*) > 1)
    AND
    (lat, lon) IN (SELECT lat, lon
                  FROM Insurance
                  GROUP BY lat, lon
                  HAVING COUNT(*) = 1)
