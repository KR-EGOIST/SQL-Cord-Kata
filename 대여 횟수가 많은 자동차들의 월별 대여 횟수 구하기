/*
조회 : SELECT
월 조회 : MONTH(날짜)
별칭 : AS
갯수 조회 : COUNT(컬럼명)
테이블 선택 : FROM
조건 : WHERE
날짜 표기 변경 : DATE_FORMAT
0000-00 : '%Y-%m'
A 와 B 사이 : BETWEEN A AND B
AND : 모두 참일 경우
서브쿼리 : IN ( )
그룹 : GROUP BY
그룹 조건 : HAVING
정렬 : ORDER BY
오름차순 : (ASC)
내림차순 : DESC
*/

SELECT MONTH(START_DATE) AS MONTH, CAR_ID, COUNT(*) AS RECORDS
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
WHERE DATE_FORMAT(START_DATE, '%Y-%m') BETWEEN '2022-08' AND '2022-10'
    AND CAR_ID IN (SELECT CAR_ID
                   FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
                   WHERE DATE_FORMAT(START_DATE, '%Y-%m') BETWEEN '2022-08' AND '2022-10'
                   GROUP BY CAR_ID
                   HAVING COUNT(CAR_ID) >= 5)
GROUP BY MONTH, CAR_ID
HAVING RECORDS > 0
ORDER BY MONTH, CAR_ID DESC
