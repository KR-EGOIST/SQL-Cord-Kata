/*
조회 : SELECT
반올림 : ROUNT(값, 자릿수)
별칭 : AS
내부 조인 : (INNER) JOIN
조인 조건 : ON
조건 : WHERE
제외하고 조회 : NOT IN
부분일치 : LIKE
AND : 모두 참일 경우
그룹 : GROUP BY
그룹 조건 : HAVING
포함 : IN
BETWEEN A AND B : A 와 B 사이
정렬 : ORDER BY
내림차순 : DESC
오름차순 : (ASC)
*/

SELECT A.CAR_ID, A.CAR_TYPE, ROUND(A.DAILY_FEE * 30 * ((100 - C.DISCOUNT_RATE) / 100), 0) AS FEE
FROM CAR_RENTAL_COMPANY_CAR A
     JOIN CAR_RENTAL_COMPANY_RENTAL_HISTORY B
     ON A.CAR_ID = B.CAR_ID
     JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN C
     ON A.CAR_TYPE = C.CAR_TYPE
WHERE A.CAR_ID NOT IN (SELECT CAR_ID
                       FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
                       WHERE END_DATE >= '2022-11-01'
                             AND START_DATE <= '2022-12-01')
      AND C.DURATION_TYPE LIKE '30%'
GROUP BY A.CAR_ID
HAVING A.CAR_TYPE IN ('세단', 'SUV')
       AND FEE BETWEEN 500000 AND 1999999
ORDER BY FEE DESC, CAR_TYPE, CAR_ID DESC
